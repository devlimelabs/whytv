<div class="relative w-full h-screen bg-black" (click)="handleTap($event)">
  <!-- Video Element -->
  <video
    #videoElement
    class="w-full h-full object-cover"
    [ngClass]="isLoading() ? 'opacity-0' : 'opacity-100'"
    playsInline
    loop
    [muted]="isMuted()"
    preload="auto"
    [poster]="video().thumbnail"
    (loadstart)="handleLoadStart()"
    (canplay)="handleCanPlay()"
    (error)="handleError()"
    (timeupdate)="handleTimeUpdate()"
    (ended)="handleVideoEnded()"
  >
    <source [src]="video().videoUrl" type="video/mp4" />
    Your browser does not support the video tag.
  </video>

  <!-- Fallback Thumbnail -->
  @if (isLoading() || error()) {
  <img
    [src]="video().thumbnail"
    [alt]="video().title"
    class="absolute inset-0 w-full h-full object-cover"
  />
  }

  <!-- Loading Indicator -->
  @if (isLoading()) {
  <div class="absolute inset-0 flex items-center justify-center bg-black/50">
    <div
      class="w-12 h-12 border-4 border-white/30 border-t-white rounded-full animate-spin"
    ></div>
  </div>
  }

  <!-- Error Message -->
  @if (error()) {
  <div class="absolute inset-0 flex items-center justify-center bg-black/50">
    <div class="bg-red-500/90 text-white px-4 py-2 rounded-lg shadow-lg">
      {{ error() }}
    </div>
  </div>
  }

  <!-- Overlay Controls -->
  <div
    class="absolute inset-0 transition-opacity duration-300"
    [ngClass]="showControls() ? 'opacity-100' : 'opacity-0'"
  >
    <!-- Play/Pause Button -->
    <div class="absolute inset-0 flex items-center justify-center">
      <button
        class="w-16 h-16 bg-black/30 rounded-full flex items-center justify-center backdrop-blur-sm transition-transform hover:scale-110"
        (click)="$event.stopPropagation(); playPause.emit()"
        [attr.aria-label]="isPlaying() ? 'Pause' : 'Play'"
      >
        @if (isPlaying()) {
        <lucide-icon [img]="Pause" class="w-8 h-8 text-white" />
        } @else {
        <lucide-icon [img]="Play" class="w-8 h-8 text-white" />
        }
      </button>
    </div>

    <!-- Side Actions -->
    <app-side-actions />

    <!-- Video Info -->
    <div
      class="absolute bottom-0 left-0 right-0 p-4 bg-gradient-to-t from-black/60 to-transparent"
    >
      <h2 class="text-white text-xl font-medium">{{ video().title }}</h2>
      <p class="text-white/80 text-sm">{{ video().channelName }}</p>
    </div>

    <!-- Progress Bar -->
    <div class="absolute bottom-0 left-0 right-0 h-1 bg-white/20">
      <div
        class="h-full bg-white transition-all duration-300"
        [style.width.%]="progress()"
      ></div>
    </div>
  </div>
</div>
